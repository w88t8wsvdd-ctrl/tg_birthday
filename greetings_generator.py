"""
Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ°.
"""

import random
from typing import List, Optional

# Ğ‘Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ°
class GenderDetector:
    """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ» Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸."""
    
    # Ğ–ĞµĞ½ÑĞºĞ¸Ğµ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ (Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ)
    FEMALE_ENDINGS = [
        'Ğ°', 'Ñ', 'Ğ¸Ñ', 'ÑŒÑ', 'Ğ½Ğ°', 'Ñ‚Ğ°', 'Ğ²Ğ°', 'Ğ³Ğ°', 'Ğ´Ğ°', 'Ğ»Ğ°', 
        'Ñ€Ğ°', 'Ğ¼Ğ°', 'Ğ·Ğ°', 'ÑĞ°', 'ĞºĞ°', 'Ğ½Ñ', 'Ğ»Ñ', 'ÑÑ', 'Ñ„Ğ°', 'Ñ‡Ğ°'
    ]
    
    # ĞœÑƒĞ¶ÑĞºĞ¸Ğµ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ (Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ)
    MALE_ENDINGS = [
        'Ğ¹', 'ÑŒ', 'Ğ½', 'Ñ€', 'Ñ‚', 'Ñ', 'Ğ²', 'Ğ»', 'Ğ¿', 'Ğ´',
        'Ğ¼', 'Ğº', 'Ğ³', 'Ğ±', 'Ğ·', 'Ñ‡', 'Ñ‰', 'Ğ¶', 'Ñ…', 'Ñ†',
        'Ñˆ', 'Ñ„'
    ]
    
    # Ğ–ĞµĞ½ÑĞºĞ¸Ğµ Ğ¸Ğ¼ĞµĞ½Ğ° (Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑĞ»ÑƒÑ‡Ğ°Ğ¸)
    FEMALE_NAMES = [
        'Ğ»ÑĞ±Ğ¾Ğ²ÑŒ', 'Ğ½Ğ¸ĞºĞ¾Ğ»ÑŒ', 'Ğ½ĞµĞ»Ğ»Ğ¸', 'Ğ²Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ñ', 'Ğ½Ğ°Ñ‚Ğ°Ğ»ÑŒÑ',
        'Ğ¾Ğ»ÑŒĞ³Ğ°', 'ĞµĞ»ĞµĞ½Ğ°', 'Ñ‚Ğ°Ñ‚ÑŒÑĞ½Ğ°', 'ÑĞ»Ğ¸Ñ', 'Ğ¸Ñ€Ğ¸Ğ½Ğ°', 'Ğ¼Ğ°Ñ€Ğ¸Ğ½Ğ°',
        'ÑĞ²ĞµÑ‚Ğ»Ğ°Ğ½Ğ°', 'ĞµĞ²Ğ³ĞµĞ½Ğ¸Ñ', 'Ğ°Ğ½Ğ°ÑÑ‚Ğ°ÑĞ¸Ñ', 'ĞºÑ€Ğ¸ÑÑ‚Ğ¸Ğ½Ğ°', 'Ğ´Ğ°Ñ€ÑŒÑ',
        'Ğ°Ğ»Ğ¸Ğ½Ğ°', 'Ğ°Ğ½Ğ³ĞµĞ»Ğ¸Ğ½Ğ°', 'Ğ²ĞµÑ€Ğ¾Ğ½Ğ¸ĞºĞ°', 'Ğ³Ğ°Ğ»Ğ¸Ğ½Ğ°', 'Ğ´Ğ¸Ğ°Ğ½Ğ°',
        'ĞµĞºĞ°Ñ‚ĞµÑ€Ğ¸Ğ½Ğ°', 'Ğ¶Ğ°Ğ½Ğ½Ğ°', 'Ğ·Ğ¾Ñ', 'Ğ¸Ğ½Ğ½Ğ°', 'ĞºĞ»Ğ°Ğ²Ğ´Ğ¸Ñ',
        'Ğ»Ğ°Ñ€Ğ¸ÑĞ°', 'Ğ»Ğ¸Ğ´Ğ¸Ñ', 'Ğ»ÑĞ´Ğ¼Ğ¸Ğ»Ğ°', 'Ğ¼Ğ°Ñ€Ğ³Ğ°Ñ€Ğ¸Ñ‚Ğ°', 'Ğ½Ğ°Ğ´ĞµĞ¶Ğ´Ğ°',
        'Ğ¾ĞºÑĞ°Ğ½Ğ°', 'Ğ¿Ğ¾Ğ»Ğ¸Ğ½Ğ°', 'Ñ€ĞµĞ³Ğ¸Ğ½Ğ°', 'ÑĞ½ĞµĞ¶Ğ°Ğ½Ğ°', 'ÑĞ¾Ñ„ÑŒÑ',
        'ÑƒĞ»ÑŒÑĞ½Ğ°', 'ÑĞ»ÑŒĞ²Ğ¸Ñ€Ğ°', 'ÑĞ»Ğ¸Ğ°Ğ½Ğ°', 'ÑĞ½Ğ°'
    ]
    
    # ĞœÑƒĞ¶ÑĞºĞ¸Ğµ Ğ¸Ğ¼ĞµĞ½Ğ° (Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑĞ»ÑƒÑ‡Ğ°Ğ¸)
    MALE_NAMES = [
        'Ğ½Ğ¸ĞºĞ¾Ğ»Ğ°Ğ¹', 'Ğ¸Ğ»ÑŒÑ', 'Ğ¸Ğ³Ğ¾Ñ€ÑŒ', 'Ğ²Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€', 'Ğ°Ğ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€',
        'Ğ´Ğ¼Ğ¸Ñ‚Ñ€Ğ¸Ğ¹', 'ÑĞµÑ€Ğ³ĞµĞ¹', 'Ğ°Ğ»ĞµĞºÑĞµĞ¹', 'Ğ°Ğ½Ğ´Ñ€ĞµĞ¹', 'Ğ¼Ğ¸Ñ…Ğ°Ğ¸Ğ»',
        'ĞµĞ²Ğ³ĞµĞ½Ğ¸Ğ¹', 'Ğ¼Ğ°ĞºÑĞ¸Ğ¼', 'Ğ°Ñ€Ñ‚ĞµĞ¼', 'Ğ²Ğ»Ğ°Ğ´Ğ¸ÑĞ»Ğ°Ğ²', 'Ğ¿Ğ°Ğ²ĞµĞ»',
        'ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ğ¸Ğ½', 'ÑÑ‚Ğ°Ğ½Ğ¸ÑĞ»Ğ°Ğ²', 'Ğ²ÑÑ‡ĞµÑĞ»Ğ°Ğ²', 'Ğ³Ñ€Ğ¸Ğ³Ğ¾Ñ€Ğ¸Ğ¹',
        'Ğ»ĞµĞ¾Ğ½Ğ¸Ğ´', 'Ğ²Ğ°Ğ´Ğ¸Ğ¼', 'Ğ²Ğ°Ğ»ĞµÑ€Ğ¸Ğ¹', 'Ğ²Ğ¸Ñ‚Ğ°Ğ»Ğ¸Ğ¹', 'Ğ³ĞµĞ¾Ñ€Ğ³Ğ¸Ğ¹',
        'Ğ´Ğ°Ğ½Ğ¸Ğ¸Ğ»', 'ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»', 'Ğ¾Ğ»ĞµĞ³', 'Ñ€Ğ¾Ğ¼Ğ°', 'ÑĞ²ÑÑ‚Ğ¾ÑĞ»Ğ°Ğ²',
        'Ñ‚Ğ¸Ğ¼ÑƒÑ€', 'Ñ„ĞµĞ´Ğ¾Ñ€', 'ÑĞ´ÑƒĞ°Ñ€Ğ´', 'ÑÑ€Ğ¸Ğ¹', 'ÑÑ€Ğ¾ÑĞ»Ğ°Ğ²'
    ]
    
    # ĞĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ğµ/ÑƒĞ½Ğ¸ÑĞµĞºÑ Ğ¸Ğ¼ĞµĞ½Ğ°
    UNISEX_NAMES = [
        'ÑĞ°ÑˆĞ°', 'Ğ¶ĞµĞ½Ñ', 'Ğ²Ğ°Ğ»Ñ', 'ÑĞ»Ğ°Ğ²Ğ°'
    ]
    
    @staticmethod
    def detect_gender(name: str) -> str:
        """
        ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ» Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸.
        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚: 'female', 'male' Ğ¸Ğ»Ğ¸ 'unknown'
        """
        if not name:
            return 'unknown'
        
        name_lower = name.lower().strip()
        first_name = name_lower.split()[0] if ' ' in name_lower else name_lower
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑĞ¿Ğ¸ÑĞºĞ¸ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ¸Ğ¼ĞµĞ½
        if first_name in GenderDetector.FEMALE_NAMES:
            return 'female'
        
        if first_name in GenderDetector.MALE_NAMES:
            return 'male'
        
        if first_name in GenderDetector.UNISEX_NAMES:
            return 'unknown'
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ
        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¶ĞµĞ½ÑĞºĞ¸Ğµ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ (Ğ¾Ğ½Ğ¸ Ğ±Ğ¾Ğ»ĞµĞµ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹)
        for ending in GenderDetector.FEMALE_ENDINGS:
            if first_name.endswith(ending):
                # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: Ğ¸Ğ¼Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ´Ğ»Ğ¸Ğ½Ğ½ĞµĞµ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ
                if len(first_name) > len(ending):
                    return 'female'
        
        # Ğ—Ğ°Ñ‚ĞµĞ¼ Ğ¼ÑƒĞ¶ÑĞºĞ¸Ğµ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ
        for ending in GenderDetector.MALE_ENDINGS:
            if first_name.endswith(ending):
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¶ĞµĞ½ÑĞºĞ¾Ğµ Ğ¸Ğ¼Ñ Ñ Ğ¼ÑƒĞ¶ÑĞºĞ¸Ğ¼ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸ĞµĞ¼
                if first_name not in GenderDetector.FEMALE_NAMES:
                    if len(first_name) > len(ending):
                        return 'male'
        
        return 'unknown'

# ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ¾Ğ¹
GREETING_STARTS = {
    'female': [
        "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ {name}, Ğ¾Ñ‚ Ğ²ÑĞµĞ¹ Ğ´ÑƒÑˆĞ¸",
        "Ğ£Ğ²Ğ°Ğ¶Ğ°ĞµĞ¼Ğ°Ñ {name}, Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğµ",
        "Ğ›ÑĞ±Ğ¸Ğ¼Ğ°Ñ {name}, ÑĞµÑ€Ğ´ĞµÑ‡Ğ½Ğ¾",
        "ĞœĞ¸Ğ»Ğ°Ñ {name}, Ñ Ñ‚ĞµĞ¿Ğ»Ğ¾Ñ‚Ğ¾Ğ¹ Ğ² ÑĞµÑ€Ğ´Ñ†Ğµ",
        "ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ°Ñ {name}, Ğ¾Ñ‚ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ´Ñ†Ğ°",
        "ĞĞ°ÑˆĞ° Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ {name}, Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ñ€Ğ°Ğ´Ğ¾ÑÑ‚ÑŒÑ",
    ],
    'male': [
        "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹ {name}, Ğ¾Ñ‚ Ğ²ÑĞµĞ¹ Ğ´ÑƒÑˆĞ¸",
        "Ğ£Ğ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹ {name}, Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğµ",
        "Ğ›ÑĞ±Ğ¸Ğ¼Ñ‹Ğ¹ {name}, ÑĞµÑ€Ğ´ĞµÑ‡Ğ½Ğ¾",
        "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹ Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ½Ğ½Ğ¸Ğº {name}, Ñ Ñ‚ĞµĞ¿Ğ»Ğ¾Ñ‚Ğ¾Ğ¹ Ğ² ÑĞµÑ€Ğ´Ñ†Ğµ",
        "ĞĞ°Ñˆ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹ {name}, Ğ¾Ñ‚ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ´Ñ†Ğ°",
        "ĞœĞ¸Ğ»Ñ‹Ğ¹ {name}, Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ñ€Ğ°Ğ´Ğ¾ÑÑ‚ÑŒÑ",
    ],
    'unknown': [
        "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹(Ğ°Ñ) {name}, Ğ¾Ñ‚ Ğ²ÑĞµĞ¹ Ğ´ÑƒÑˆĞ¸",
        "Ğ£Ğ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹(Ğ°Ñ) {name}, Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğµ",
        "{name}, ÑĞµÑ€Ğ´ĞµÑ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼",
        "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹ Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ½Ğ½Ğ¸Ğº {name}, Ğ¾Ñ‚ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ´Ñ†Ğ°",
    ]
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ)
MAIN_GREETINGS = [
    "Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµĞ±Ñ Ñ Ğ´Ğ½Ñ‘Ğ¼ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ!",
    "Ğ¶ĞµĞ»Ğ°ĞµĞ¼ Ñ‚ĞµĞ±Ğµ Ğ²ÑĞµĞ³Ğ¾ ÑĞ°Ğ¼Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ğ¸Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ Ğ² ÑÑ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ!",
    "Ğ¾Ñ‚ Ğ²ÑĞµĞ¹ Ğ´ÑƒÑˆĞ¸ Ğ¶ĞµĞ»Ğ°ĞµĞ¼ ÑÑ‡Ğ°ÑÑ‚ÑŒÑ, Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ Ğ¸ Ğ¿Ñ€Ğ¾Ñ†Ğ²ĞµÑ‚Ğ°Ğ½Ğ¸Ñ!",
    "Ğ¿Ñ€Ğ¸Ğ¼Ğ¸ ÑĞ°Ğ¼Ñ‹Ğµ Ñ‚Ñ‘Ğ¿Ğ»Ñ‹Ğµ Ğ¿Ğ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ Ğ² Ñ‚Ğ²Ğ¾Ğ¹ Ğ´ĞµĞ½ÑŒ!",
    "Ğ¿ÑƒÑÑ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ´ĞµĞ½ÑŒ Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑÑ Ñ€Ğ°Ğ´Ğ¾ÑÑ‚Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸!",
    "Ğ¶ĞµĞ»Ğ°ĞµĞ¼, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑÑ‚Ğ¾Ñ‚ Ğ³Ğ¾Ğ´ ÑÑ‚Ğ°Ğ» Ğ´Ğ»Ñ Ñ‚ĞµĞ±Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ñ‹Ğ¼!",
]

# Ğ“ĞµĞ½Ğ´ĞµÑ€Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ¾Ğ¹
GENDER_WISHES = {
    'female': [
        "ĞŸÑƒÑÑ‚ÑŒ Ñ‚Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¾ÑÑ‚Ğ°ĞµÑˆÑŒÑÑ ÑĞ°Ğ¼Ğ¾Ğ¹ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾Ğ¹ Ğ¸ Ğ¶ĞµĞ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ¹!",
        "Ğ–ĞµĞ»Ğ°ĞµĞ¼ Ñ‚ĞµĞ±Ğµ Ğ½ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸, Ğ·Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸ Ğ»ÑĞ±Ğ²Ğ¸!",
        "Ğ‘ÑƒĞ´ÑŒ ÑĞ°Ğ¼Ğ¾Ğ¹ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ğ¾Ğ¹ Ğ¸ Ğ»ÑĞ±Ğ¸Ğ¼Ğ¾Ğ¹!",
        "Ğ¦Ğ²ĞµÑ‚Ğ¸ Ğ¸ Ñ€Ğ°Ğ´ÑƒĞ¹ Ğ¾ĞºÑ€ÑƒĞ¶Ğ°ÑÑ‰Ğ¸Ñ… ÑĞ²Ğ¾ĞµĞ¹ ÑƒĞ»Ñ‹Ğ±ĞºĞ¾Ğ¹!",
        "ĞŸÑƒÑÑ‚ÑŒ Ğ°Ğ½Ğ³ĞµĞ»-Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ±ĞµÑ€ĞµĞ³Ğ°ĞµÑ‚ Ñ‚ĞµĞ±Ñ Ğ½Ğ° Ğ²ÑĞµÑ… Ğ¿ÑƒÑ‚ÑÑ…!",
    ],
    'male': [
        "Ğ‘ÑƒĞ´ÑŒ ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¼, Ñ€ĞµÑˆĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ¸ Ñ†ĞµĞ»ĞµÑƒÑÑ‚Ñ€ĞµĞ¼Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¼!",
        "Ğ–ĞµĞ»Ğ°ĞµĞ¼ Ñ‚ĞµĞ±Ğµ Ğ¼ÑƒĞ¶ÑĞºĞ¾Ğ¹ Ğ¼ÑƒĞ´Ñ€Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑÑ‚Ğ¾Ğ¹ĞºĞ¾ÑÑ‚Ğ¸!",
        "ĞŸÑƒÑÑ‚ÑŒ ÑƒĞ´Ğ°Ñ‡Ğ° ÑĞ¾Ğ¿ÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ğ½Ğ¸ÑÑ…!",
        "Ğ‘ÑƒĞ´ÑŒ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğ¼ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ¼ Ğ¸ Ğ¾Ğ¿Ğ¾Ñ€Ğ¾Ğ¹ Ğ´Ğ»Ñ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¸Ñ…!",
        "Ğ–ĞµĞ»Ğ°ĞµĞ¼ ĞºÑ€ĞµĞ¿ĞºĞ¾Ğ³Ğ¾ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ Ğ¸ Ğ²Ñ‹Ğ½Ğ¾ÑĞ»Ğ¸Ğ²Ğ¾ÑÑ‚Ğ¸!",
    ],
    'unknown': [
        "Ğ‘ÑƒĞ´ÑŒ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¼ Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼!",
        "ĞŸÑƒÑÑ‚ÑŒ Ğ²ÑĞµ Ğ¼ĞµÑ‡Ñ‚Ñ‹ ÑĞ±Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ!",
        "Ğ–ĞµĞ»Ğ°ĞµĞ¼ Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ğ¸ Ğ¸ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ!",
        "ĞŸÑƒÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ ÑÑ€ĞºĞ¾Ğ¹ Ğ¸ Ğ½Ğ°ÑÑ‹Ñ‰ĞµĞ½Ğ½Ğ¾Ğ¹!",
    ]
}

# ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ğ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ (Ğ±ĞµĞ· Ğ³ĞµĞ½Ğ´ĞµÑ€Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·ĞºĞ¸)
COMMON_WISHES = [
    "ĞšÑ€ĞµĞ¿ĞºĞ¾Ğ³Ğ¾ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ, Ğ±Ğ¾Ğ´Ñ€Ğ¾ÑÑ‚Ğ¸ Ğ´ÑƒÑ…Ğ° Ğ¸ Ğ½ĞµĞ¸ÑÑÑĞºĞ°ĞµĞ¼Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸!",
    "ĞÑˆĞµĞ»Ğ¾Ğ¼Ğ»ÑÑÑ‰Ğ¸Ñ… ÑƒÑĞ¿ĞµÑ…Ğ¾Ğ² Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ Ğ¸ ĞºĞ°Ñ€ÑŒĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ¾ÑÑ‚Ğ°!",
    "Ğ›Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‡Ğ°ÑÑ‚ÑŒÑ, ÑƒÑÑ‚Ğ° Ğ² Ğ´Ğ¾Ğ¼Ğµ Ğ¸ Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ğ¸ Ğ² Ğ´ÑƒÑˆĞµ!",
    "Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸, Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ´ĞµĞ¹ Ğ¸ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ!",
    "Ğ˜ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ²ÑĞµÑ… Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ğ¹ Ğ¸ Ğ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ¼ĞµĞ»Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²!",
    "Ğ£Ğ²Ğ»ĞµĞºĞ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¸ Ğ½ĞµĞ·Ğ°Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼Ñ‹Ñ… Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ĞµĞ½Ğ¸Ğ¹!",
    "Ğ’ĞµÑ€Ğ½Ñ‹Ñ… Ğ´Ñ€ÑƒĞ·ĞµĞ¹, Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ÑÑ‰Ğ¸Ñ… ĞºĞ¾Ğ»Ğ»ĞµĞ³ Ğ¸ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ¾Ğ²!",
    "Ğ¢Ğ²Ğ¾Ñ€Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ²Ğ´Ğ¾Ñ…Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ¼ĞµĞ»Ñ‹Ñ… ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²!",
]

# Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ
ENDINGS = {
    'female': [
        "Ğ‘ÑƒĞ´ÑŒ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ, ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ!",
        "ĞŸÑƒÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ Ğ´Ğ°Ñ€Ğ¸Ñ‚ Ñ‚ĞµĞ±Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğµ ÑÑÑ€Ğ¿Ñ€Ğ¸Ğ·Ñ‹!",
        "ĞÑÑ‚Ğ°Ğ²Ğ°Ğ¹ÑÑ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ¶Ğµ Ğ»ÑƒÑ‡ĞµĞ·Ğ°Ñ€Ğ½Ğ¾Ğ¹ Ğ¸ Ğ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹!",
        "Ğ¡Ğ¸ÑĞ¹, ĞºĞ°Ğº ÑĞ¾Ğ»Ğ½Ñ‹ÑˆĞºĞ¾, Ğ¸ ÑĞ¾Ğ³Ñ€ĞµĞ²Ğ°Ğ¹ Ğ²ÑĞµÑ… Ğ²Ğ¾ĞºÑ€ÑƒĞ³!",
    ],
    'male': [
        "Ğ‘ÑƒĞ´ÑŒ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ² ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ, ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ!",
        "ĞŸÑƒÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ Ğ´Ğ°Ñ€Ğ¸Ñ‚ Ñ‚ĞµĞ±Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğµ ÑÑÑ€Ğ¿Ñ€Ğ¸Ğ·Ñ‹!",
        "ĞÑÑ‚Ğ°Ğ²Ğ°Ğ¹ÑÑ Ñ‚Ğ°ĞºĞ¸Ğ¼ Ğ¶Ğµ ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¸ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¼!",
        "Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ°Ğ¹ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ²Ñ‹ÑĞ¾Ñ‚ Ğ¸ Ğ¿Ğ¾ĞºĞ¾Ñ€ÑĞ¹ Ğ²ĞµÑ€ÑˆĞ¸Ğ½Ñ‹!",
    ],
    'unknown': [
        "Ğ‘ÑƒĞ´ÑŒ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²(Ğ°) ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ!",
        "ĞŸÑƒÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ Ğ´Ğ°Ñ€Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğµ ÑÑÑ€Ğ¿Ñ€Ğ¸Ğ·Ñ‹!",
        "Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ°Ğ¹ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ²Ñ‹ÑĞ¾Ñ‚!",
        "Ğ Ğ°Ğ´ÑƒĞ¹ÑÑ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼Ñƒ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñƒ!",
    ]
}

class ImprovedGreetingGenerator:
    """Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ°."""
    
    def __init__(self):
        self.gender_detector = GenderDetector()
        self.used_combinations = set()
    
    def _get_season(self) -> str:
        """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞµĞ·Ğ¾Ğ½."""
        from datetime import datetime
        month = datetime.now().month
        
        if month in [12, 1, 2]:
            return "winter"
        elif month in [3, 4, 5]:
            return "spring"
        elif month in [6, 7, 8]:
            return "summer"
        else:
            return "autumn"
    
    def _extract_first_name(self, full_name: str) -> str:
        """Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸."""
        if not full_name:
            return ""
        
        # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹
        cleaned = ' '.join(full_name.strip().split())
        
        # Ğ‘ĞµÑ€ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ (Ğ¸Ğ¼Ñ)
        first_name = cleaned.split()[0] if ' ' in cleaned else cleaned
        
        # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
        first_name = first_name.split('(')[0].strip()
        first_name = first_name.split('-')[0].strip()
        
        return first_name
    
    def generate_greeting(self, name: str, min_sentences: int = 3, max_sentences: int = 5) -> str:
        """
        Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ¾Ğ¹.
        """
        # Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ
        first_name = self._extract_first_name(name)
        
        if not first_name:
            first_name = name  # fallback
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»
        gender = self.gender_detector.detect_gender(first_name)
        
        # Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ:
        # print(f"DEBUG: Ğ˜Ğ¼Ñ '{name}' -> Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ '{first_name}' -> Ğ¿Ğ¾Ğ» '{gender}'")
        
        # Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»Ğ°
        start = random.choice(GREETING_STARTS.get(gender, GREETING_STARTS['unknown']))
        start = start.format(name=first_name)
        
        main_greeting = random.choice(MAIN_GREETINGS)
        
        # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ
        all_wishes = COMMON_WISHES.copy()
        all_wishes.extend(GENDER_WISHES.get(gender, GENDER_WISHES['unknown']))
        
        # Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ 1-2 ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ
        selected_wishes = random.sample(all_wishes, min(2, len(all_wishes)))
        
        # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
        sentences = [start, main_greeting]
        sentences.extend(selected_wishes)
        
        # Ğ¡ ÑˆĞ°Ğ½ÑĞ¾Ğ¼ 50% Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ
        if random.random() > 0.5 and len(sentences) < max_sentences:
            ending = random.choice(ENDINGS.get(gender, ENDINGS['unknown']))
            sentences.append(ending)
        
        # ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµĞ¼ Ğ² Ñ‚ĞµĞºÑÑ‚
        greeting_text = " ".join(sentences)
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸
        emojis = ["ğŸ‰", "ğŸ‚", "âœ¨", "ğŸ¥³", "ğŸŠ", "ğŸŒŸ", "ğŸ", "ğŸ’"]
        greeting_text += " " + random.choice(emojis)
        
        return greeting_text
    
    def generate_collective_greeting(self, names: List[str]) -> str:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ."""
        if not names:
            return ""
        
        # Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ Ğ¸Ğ¼ĞµĞ½Ğ°
        first_names = [self._extract_first_name(name) for name in names]
        names_str = ", ".join(first_names)
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½Ñ‹
        has_females = any(self.gender_detector.detect_gender(name) == 'female' for name in first_names)
        has_males = any(self.gender_detector.detect_gender(name) == 'male' for name in first_names)
        
        # Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ°
        if has_females and not has_males:
            address = f"Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ {names_str}"
        elif has_males and not has_females:
            address = f"Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ {names_str}"
        else:
            address = f"Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ {names_str}"
        
        templates = [
            f"{address}! ĞÑ‚ Ğ²ÑĞµĞ¹ Ğ´ÑƒÑˆĞ¸ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ²Ğ°Ñ Ñ Ğ´Ğ½Ñ‘Ğ¼ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ! "
            f"Ğ–ĞµĞ»Ğ°ĞµĞ¼ ĞºÑ€ĞµĞ¿ĞºĞ¾Ğ³Ğ¾ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ, ÑÑ‡Ğ°ÑÑ‚ÑŒÑ Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ¾Ğ² Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ğ½Ğ¸ÑÑ…! "
            f"ĞŸÑƒÑÑ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¸Ğ½Ğ¾ÑĞ¸Ñ‚ Ñ€Ğ°Ğ´Ğ¾ÑÑ‚ÑŒ Ğ¸ ÑƒĞ´Ğ¾Ğ²Ğ»ĞµÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¸Ğµ! ğŸ‰ğŸ‚âœ¨",
            
            f"{address}! Ğ¡ĞµÑ€Ğ´ĞµÑ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ Ğ´Ğ½Ñ‘Ğ¼ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ! "
            f"Ğ–ĞµĞ»Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ğ±ĞµĞ´, Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‡Ğ°ÑÑ‚ÑŒÑ Ğ¸ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ! "
            f"ĞŸÑƒÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ½Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° ÑÑ€ĞºĞ¸Ğ¼Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸ Ğ¸ Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğ¼Ğ¸ ÑÑÑ€Ğ¿Ñ€Ğ¸Ğ·Ğ°Ğ¼Ğ¸! ğŸ¥³ğŸŠğŸŒŸ",
            
            f"{address}! ĞŸÑ€Ğ¸Ğ¼Ğ¸Ñ‚Ğµ ÑĞ°Ğ¼Ñ‹Ğµ Ñ‚Ñ‘Ğ¿Ğ»Ñ‹Ğµ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ! "
            f"Ğ–ĞµĞ»Ğ°ĞµĞ¼ Ğ½ĞµĞ¸ÑÑÑĞºĞ°ĞµĞ¼Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸, Ğ²Ğ´Ğ¾Ñ…Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ Ğ¸ ÑƒĞ´Ğ°Ñ‡Ğ¸! "
            f"ĞŸÑƒÑÑ‚ÑŒ Ğ²ÑĞµ Ğ¼ĞµÑ‡Ñ‚Ñ‹ ÑĞ±Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ, Ğ° Ğ¿Ğ»Ğ°Ğ½Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒÑÑ‚ÑÑ! ğŸ’«ğŸâ¤ï¸"
        ]
        
        return random.choice(templates)

# Ğ¡Ğ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½-ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€
_generator_instance = None

def get_generator() -> ImprovedGreetingGenerator:
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ°."""
    global _generator_instance
    if _generator_instance is None:
        _generator_instance = ImprovedGreetingGenerator()
    return _generator_instance

def generate_greeting(name: str, min_sentences: int = 3, max_sentences: int = 5) -> str:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ."""
    generator = get_generator()
    return generator.generate_greeting(name, min_sentences, max_sentences)

def generate_collective_greeting(names: List[str]) -> str:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ."""
    generator = get_generator()
    return generator.generate_collective_greeting(names)

# Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
def test_gender_detection():
    """Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ğ°."""
    test_cases = [
        # (Ğ¸Ğ¼Ñ, Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»)
        ("ĞĞ½Ğ½Ğ°", "female"),
        ("ĞœĞ°Ñ€Ğ¸Ñ", "female"),
        ("Ğ•Ğ»ĞµĞ½Ğ°", "female"),
        ("Ğ˜Ğ²Ğ°Ğ½", "male"),
        ("ĞŸĞµÑ‚Ñ€", "male"),
        ("ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€", "male"),
        ("Ğ¡Ğ°ÑˆĞ°", "unknown"),
        ("Ğ–ĞµĞ½Ñ", "unknown"),
        ("Ğ›ÑĞ±Ğ¾Ğ²ÑŒ", "female"),
        ("Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ñ", "female"),
        ("ĞĞ¸ĞºĞ¾Ğ»Ğ°Ğ¹", "male"),
        ("Ğ˜Ğ»ÑŒÑ", "male"),
        ("ĞĞ½Ğ½Ğ° Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²Ğ½Ğ°", "female"),
        ("Ğ˜Ğ²Ğ°Ğ½ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²Ğ¸Ñ‡", "male"),
        ("Ğ•Ğ²Ğ³ĞµĞ½Ğ¸Ğ¹", "male"),
        ("Ğ•Ğ²Ğ³ĞµĞ½Ğ¸Ñ", "female"),
    ]
    
    detector = GenderDetector()
    
    print("ğŸ§ª Ğ¢ĞµÑÑ‚ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ°:")
    print("-" * 50)
    
    for name, expected in test_cases:
        result = detector.detect_gender(name)
        status = "âœ…" if result == expected else "âŒ"
        print(f"{status} '{name}' -> {result} (Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ»Ğ¾ÑÑŒ: {expected})")
    
    print("-" * 50)
    
    # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¸Ğ· Ğ²Ğ°ÑˆĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    your_names = [
        "Ğ›ÑĞ±Ñ‡ĞµĞ½ĞºĞ¾ Ğ•Ğ²Ğ³ĞµĞ½Ğ¸Ğ¹", "ĞœĞ¸Ñ‚Ñ€Ğ¾Ñ„Ğ°Ğ½Ğ¾Ğ²Ğ° Ğ’Ğ°Ğ»ĞµÑ€Ğ¸Ñ", "ĞœĞµĞ½ÑŒÑˆĞ¸ĞºĞ¾Ğ² Ğ•Ğ²Ğ³ĞµĞ½Ğ¸Ğ¹",
        "Ğ¨Ğ°Ğ»Ğ¸Ğ¼Ğ¾Ğ²Ğ° Ğ›ÑĞ±Ğ¾Ğ²ÑŒ", "Ğ¡Ğ°Ñ…Ğ°Ñ€Ğ¾Ğ²Ğ° Ğ•Ğ»ĞµĞ½Ğ°", "Ğ£Ğ¶Ğ°ĞºĞ¸Ğ½Ğ° Ğ”Ğ°Ñ€ÑŒÑ",
        "Ğ˜Ğ³Ğ°ÑˆĞµĞ²Ğ° Ğ®Ğ»Ğ¸Ñ", "Ğ‘Ğ¾ĞµĞ²Ğ° (Ğ“Ñ€ĞµÑ‡Ğ°Ğ½Ğ°Ñ) ĞĞ°Ğ´ĞµĞ¶Ğ´Ğ°", "Ğ—Ğ°Ğ²Ğ°Ğ»Ğ¸Ñ‰ĞµĞ²Ğ° ĞĞ°Ñ‚Ğ°Ğ»ÑŒÑ"
    ]
    
    print("\nğŸ§ª Ğ¢ĞµÑÑ‚ Ğ½Ğ° Ğ²Ğ°ÑˆĞ¸Ñ… Ğ¸Ğ¼ĞµĞ½Ğ°Ñ…:")
    print("-" * 50)
    
    for name in your_names:
        result = detector.detect_gender(name)
        print(f"â€¢ '{name}' -> {result}")
